<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" type="text/css" href="../css/index.css">
    <title>Gestión de Empleados</title>
    <link rel="stylesheet" th:href="@{../CSS/index.css}">
</head>
<body class="body2">

<!-- Header admin -->
<div th:replace="~{itemss/headeradmin :: miHeader}"></div>

<div class="main">
    <div class="card">
        <h1 th:text="${empleado != null and empleado.id_emple != null} ? 'Editar Empleado' : 'Gestión de Empleados'"></h1>

        <form class="formulario-mensaje" th:action="@{/admin/empleado/guardar}" method="post" th:object="${empleado}">

            <div class="form-group">
                <input type="text" placeholder="Nombre" th:field="*{nomEmple}" required>
                <input type="text" placeholder="Teléfono" th:field="*{tel_emple}">
            </div>
            <div class="form-group">
                <input type="text" placeholder="Correo" th:field="*{correo}">
                <input type="text" placeholder="Dirección" th:field="*{dir_emple}">
            </div>
            <div class="form-group">
                <input type="text" placeholder="Tipo de sangre" th:field="*{rh_emple}">
                <input type="date" placeholder="Fecha nacimiento"
                       onfocus="this.type='date'" onblur="if(!this.value) this.type='text'" th:field="*{fecha_naci_emple}">
            </div>
            <div class="form-group">
                <input type="date" placeholder="Fecha ingreso"
                       onfocus="this.type='date'" onblur="if(!this.value) this.type='text'" th:field="*{fecha_ing_emple}">
                <select th:field="*{tipo_identificacion}" style="border-radius: 8px">
                    <option value="CC">Cédula de Ciudadanía</option>
                    <option value="CE">Cédula Extranjera</option>
                    <option value="PEP">Permiso Especial de Permanencia</option>
                </select>
            </div>
            <div class="form-group">
                <input type="text" placeholder="Número ID" th:field="*{num_indetificacion}">
                <input type="text" placeholder="Salario" th:field="*{salari_emple}">
            </div>
            <div class="form-group">
                <input type="text" placeholder="Estado" th:field="*{estado_emple}">
                <input type="text" placeholder="Usuario" th:field="*{usuario}">
            </div>
            <div class="form-group">
                <input type="password" placeholder="Contraseña" th:field="*{contraseña}">
                <select th:field="*{rol.id_rol}" required style="border-radius:8px">
                    <option value="" disabled selected>-- Seleccione un rol --</option>
                    <option th:each="r : ${roles}"
                            th:value="${r.id_rol}"
                            th:text="${r.nomRol}">
                    </option>
                </select>
            </div>
            <button type="submit" class="save-btn">Insertar</button>
        </form>

        <div id="mensaje" th:if="${param.success}" style="color:purple; font-weight:bold; margin-bottom:10px;">
            ¡Se insertó correctamente!
        </div>
    </div>

    <!-- BUSCADOR -->
    <div id="search" class="search">
        <form th:action="@{/admin/empleado/buscar}" method="get">
            <input type="text" name="buscar" placeholder="Escribe lo que quieras consultar" id="searchInput">
            <input type="submit" value="Buscar" id="btnSearch">
        </form>
    </div>

    <!-- TABLA DE EMPLEADOS -->
    <table>
        <thead>
        <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Teléfono</th>
            <th>Correo</th>
            <th>Dirección</th>
            <th>Rh</th>
            <th>Fecha de nacimiento</th>
            <th>Tipo ID</th>
            <th>Número ID</th>
            <th>Fecha de ingreso</th>
            <th>Salario</th>
            <th>Estado</th>
            <th>Usuario</th>
            <th>Rol</th>
            <th>Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="r : ${empleados}">
            <td th:text="${r.id_emple}"></td>
            <td th:text="${r.nomEmple}"></td>
            <td th:text="${r.tel_emple}"></td>
            <td th:text="${r.correo}"></td>
            <td th:text="${r.dir_emple}"></td>
            <td th:text="${r.rh_emple}"></td>
            <td th:text="${r.fecha_naci_emple}"></td>
            <td th:text="${r.tipo_identificacion}"></td>
            <td th:text="${r.num_indetificacion}"></td>
            <td th:text="${r.fecha_ing_emple}"></td>
            <td th:text="${r.salari_emple}"></td>
            <td th:text="${r.estado_emple}"></td>
            <td th:text="${r.usuario}"></td>
            <td th:text="${r.rol.nomRol}"></td>
            <td>
                <a class="btn-accion" th:href="@{'/admin/empleado/editar/' + ${r.id_emple}}">Actualizar</a>
                <a class="btn-eliminar" th:href="@{'/admin/empleado/eliminar/' + ${r.id_emple}}" style="margin-top: 10px">Eliminar</a>
            </td>
        </tr>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <td colspan="15">No se encontraron resultados</td>
        </tr>
        </tbody>
    </table>
</div>

<!-- Scripts -->
<script src="/js/confirmacion.js"></script>
<script src="/js/eliminar.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      const toggleBtn = document.getElementById("formToggle");
      const submenu = document.getElementById("submenuForm");

      toggleBtn?.addEventListener("click", function(e) {
        e.preventDefault();
        submenu?.classList.toggle("show");
      });
    });
</script>

</body>
</html>

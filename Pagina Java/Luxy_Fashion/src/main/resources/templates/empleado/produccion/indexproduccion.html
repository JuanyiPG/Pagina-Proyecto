<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <title>Gestión de Producción</title>
</head>

<body class="body2">

<!-- HEADER ADMIN -->
<div th:replace="~{itemss/headeradmin :: miHeader}"></div>

<div class="main">

    <div class="card">

        <h1 th:text="${produccion != null and produccion.id_producc != null}
                ? 'Editar Producción'
                : 'Registrar Producción'">
        </h1>

        <!-- FORMULARIO -->
        <form class="formulario-mensaje" th:action="@{/emple/produccion/guardar}"
              method="post" th:object="${produccion}">

            <input type="hidden" th:field="*{id_producc}"/>

            <div class="form-group">
                <input type="date" placeholder="Fecha inicio" th:field="*{fechaIniProducc}" required>
                <input type="date" placeholder="Fecha fin" th:field="*{fecha_fin_producc}">
            </div>

            <div class="form-group">
                <input type="number" step="0.01" placeholder="Cantidad producida" th:field="*{cant_producc}">
                <input type="number" step="0.01" placeholder="Costo mano de obra" th:field="*{costo_mano_obra_producc}">
            </div>

            <div class="form-group">
                <input type="number" step="0.01" placeholder="Costo material" th:field="*{costo_mat_producc}">
                <input type="number" step="0.01" placeholder="Costo IVA" th:field="*{costo_iva_producc}">
            </div>

            <div class="form-group">
                <input type="number" step="0.01" placeholder="Costo total" th:field="*{costo_total_producc}">
                <input type="text" placeholder="Estado" th:field="*{estado_producc}">
            </div>

            <div class="form-group">
                <!-- SELECT EMPLEADO -->
                <select th:field="*{empleado.id_emple}" required style="border-radius:8px">
                    <option value="">-- Seleccione empleado --</option>
                    <option th:each="e : ${empleados}"
                            th:value="${e.id_emple}"
                            th:text="${e.nomEmple}">
                    </option>
                </select>

                <!-- SELECT PEDIDO -->
                <select th:field="*{pedido.id_pedido}" required style="border-radius:8px">
                    <option value="">-- Seleccione pedido --</option>
                    <option th:each="p : ${pedidos}"
                            th:value="${p.id_pedido}"
                            th:text="'Pedido #' + ${p.id_pedido}">
                    </option>
                </select>
            </div>

            <div class="form-group">
                <!-- SELECT MATERIA PRIMA -->
                <select th:field="*{materiaPrima.id_matp}" required style="border-radius:8px">
                    <option value="">-- Seleccione materia prima --</option>
                    <option th:each="m : ${materias}"
                            th:value="${m.id_matp}"
                            th:text="${m.nomMatp}">
                    </option>
                </select>
            </div>

            <button type="submit" class="save-btn">Guardar</button>
        </form>

        <!-- MENSAJE -->
        <div id="mensaje"
             th:if="${param.success}"
             style="color:purple; font-weight:bold; margin-bottom:10px;">
            ¡Registro guardado correctamente!
        </div>
    </div>

    <!-- BUSCADOR -->
    <div id="search" class="search">
        <form th:action="@{/emple/produccion/buscar}" method="get">
            <input type="text" name="filtro" placeholder="Buscar producción..." id="searchInput" th:value="${filtro}">
            <input type="submit" value="Buscar" id="btnSearch">
        </form>
    </div>

    <!-- TABLA -->
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>Fecha inicio</th>
            <th>Fecha fin</th>
            <th>Cantidad</th>
            <th>Costo Mano Obra</th>
            <th>Costo Material</th>
            <th>Costo IVA</th>
            <th>Costo Total</th>
            <th>Estado</th>
            <th>Empleado</th>
            <th>Pedido</th>
            <th>Materia Prima</th>
            <th>Acciones</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="p : ${producciones}">
            <td th:text="${p.id_producc}"></td>
            <td th:text="${p.fechaIniProducc}"></td>
            <td th:text="${p.fecha_fin_producc}"></td>
            <td th:text="${p.cant_producc}"></td>
            <td th:text="${p.costo_mano_obra_producc}"></td>
            <td th:text="${p.costo_mat_producc}"></td>
            <td th:text="${p.costo_iva_producc}"></td>
            <td th:text="${p.costo_total_producc}"></td>
            <td th:text="${p.estado_producc}"></td>
            <td th:text="${p.empleado.nomEmple}"></td>
            <td th:text="${p.pedido.id_pedido}"></td>
            <td th:text="${p.materiaPrima.nomMatp}"></td>

            <td>
                <a class="btn-accion" th:href="@{'/emple/produccion/editar/' + ${p.id_producc}}">Editar</a>
                <a class="btn-eliminar" th:href="@{'/emple/produccion/eliminar/' + ${p.id_producc}}">Eliminar</a>
            </td>
        </tr>

        <tr th:if="${producciones.size() == 0}">
            <td colspan="13" style="text-align:center; font-weight:bold;">
                No se encontraron resultados.
            </td>
        </tr>

        </tbody>
    </table>

</div>

<!-- Scripts -->
<script th:src="@{/js/eliminar.js}"></script>

</body>
</html>

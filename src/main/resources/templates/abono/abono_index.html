<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Abonos</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<h1>Lista de Abonos</h1>

<!-- Formulario para agregar nuevo abono -->
<h2>Agregar Abono</h2>
<form th:action="@{/abono/guardar}" th:object="${abono}" method="post">
    <label>Fecha:</label>
    <input type="date" th:field="*{fechaabono}" required><br>

    <label>Monto:</label>
    <input type="number" step="0.01" th:field="*{monto_abono}" required><br>

    <label>Método de pago:</label>
    <input type="text" th:field="*{metodo_pago}" required><br>

    <label>Descripción:</label>
    <input type="text" th:field="*{descripcion}"><br>

    <label>Factura:</label>
    <select name="facturaId" required>
        <option value="" disabled selected>Seleccione factura</option>
        <th:block th:each="factura : ${facturas}">
            <option th:value="${factura.id_factuv}"
                    th:text="${'ID: ' + factura.id_factuv + ' - Total: ' + factura.total_factuv}"></option>
        </th:block>
    </select><br><br>

    <button type="submit">Guardar Abono</button>
</form>

<!-- Tabla de abonos -->
<h2>Listado de Abonos</h2>
<table border="1">
    <thead>
    <tr>
        <th>ID</th>
        <th>Fecha</th>
        <th>Monto</th>
        <th>Método de pago</th>
        <th>Descripción</th>
        <th>Factura</th>
        <th>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="abono : ${abonos}">
        <td th:text="${abono.id_abono}"></td>
        <td th:text="${#dates.format(abono.fechaabono, 'yyyy-MM-dd')}"></td>
        <td th:text="${abono.monto_abono}"></td>
        <td th:text="${abono.metodo_pago}"></td>
        <td th:text="${abono.descripcion}"></td>
        <td th:text="${abono.facturaVenta != null ? 'ID: ' + abono.facturaVenta.id_factuv : 'N/A'}"></td>
        <td>
            <a th:href="@{/abono/eliminar/{id}(id=${abono.id_abono})}"
               onclick="return confirm('¿Desea eliminar este abono?')">Eliminar</a>
        </td>
    </tr>
    </tbody>
</table>
</body>
</html>

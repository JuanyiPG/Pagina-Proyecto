<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Abonos</title>
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="body2">
<div th:replace="~{itemss/headeradmin :: miHeader}"></div>
<!-- Formulario para agregar nuevo abono -->
<div class="main">
    <div class="card">
        <h2>Agregar Abono</h2>
        <form class="formulario-mensaje" th:action="@{/abono/guardar}" th:object="${abono}" method="post">
            <div class="form-group">
    <input type="date" th:field="*{fechaabono}" placeholder="Fecha" required><br>
                <input type="number" step="0.01" th:field="*{monto_abono}" placeholder="Monto" required><br>
            </div>
            <div class="form-group">
    <input type="text" th:field="*{metodo_pago}" placeholder="Metodo de pago" required><br>
                <input type="text" th:field="*{descripcion}" placeholder="Descripcion"><br>
            </div>
            <div class="form-group">
    <select name="facturaId" required>
        <option value="" disabled selected>Seleccione factura</option>
        <th:block th:each="factura : ${facturas}">
            <option th:value="${factura.id_factuv}"
                    th:text="${'ID: ' + factura.id_factuv + ' - Total: ' + factura.total_factuv}"></option>
        </th:block>
    </select><br><br>
            </div>
    <button type="submit" class="save-btn">Guardar Abono</button>
</form>
</div>
<div id="search" class="search">
    <form th:action="@{/abono/buscar}" method="get">
        <input type="text" name="buscar" placeholder="Escribe lo que quieras consultar" id="searchInput">
        <input type="submit" value="Buscar" id="btnSearch">
    </form>
</div>
<!-- Tabla de abonos -->

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Fecha</th>
        <th>Monto</th>
        <th>Método de pago</th>
        <th>Descripción</th>
        <th>Factura</th>
        <th>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="abono : ${abonos}">
        <td th:text="${abono.id_abono}"></td>
        <td th:text="${#dates.format(abono.fechaabono, 'yyyy-MM-dd')}"></td>
        <td th:text="${abono.monto_abono}"></td>
        <td th:text="${abono.metodo_pago}"></td>
        <td th:text="${abono.descripcion}"></td>
        <td th:text="${abono.facturaVenta != null ? 'ID: ' + abono.facturaVenta.id_factuv : 'N/A'}"></td>
        <td>
            <a th:href="@{/abono/eliminar/{id}(id=${abono.id_abono})}"
               onclick="return confirm('¿Desea eliminar este abono?')">Eliminar</a>
        </td>
    </tr>
    <tr th:if="${empleados != null and #lists.isEmpty(empleados)}">
        <td colspan="3">No se encontraron resultados</td>
    </tr>
    </tbody>
</table>
</div>
<!---------JAVA SCRIPT--------->
<script src="/js/confirmacion.js"></script>
<script src="/js/eliminar.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      const toggleBtn = document.getElementById("formToggle");
      const submenu = document.getElementById("submenuForm");

      toggleBtn.addEventListener("click", function(e) {
        e.preventDefault();
        submenu.classList.toggle("show");
      });
    });
</script>
</body>
</html>
